{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{407:function(s,t,a){\"use strict\";a.r(t);var n=a(42),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[a(\"h1\",{attrs:{id:\"pm2管理node-js项目\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#pm2管理node-js项目\"}},[s._v(\"#\")]),s._v(\" pm2管理Node.js项目\")]),s._v(\" \"),a(\"p\",[s._v(\"平常运行 Node.js 项目是通过终端运行的，如果我们关闭终端时，服务也会停止，在服务器这样运行 Node.js 项目显然不合理。\")]),s._v(\" \"),a(\"p\",[s._v(\"如果这样运行的时候，服务端抛出一个错又如何处理？我们知道 Node.js 服务抛出意味着服务停止，用户没法访问你的网站。\")]),s._v(\" \"),a(\"p\",[s._v(\"这些问题我们借助 pm2 来解决 。\")]),s._v(\" \"),a(\"h2\",{attrs:{id:\"_1、-pm2\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1、-pm2\"}},[s._v(\"#\")]),s._v(\" 1、 PM2\")]),s._v(\" \"),a(\"p\",[s._v(\"pm2 是 Node.js 的应用进程管理器。\")]),s._v(\" \"),a(\"p\",[a(\"img\",{attrs:{src:\"pm2.png\",alt:\"pm2\"}})]),s._v(\" \"),a(\"p\",[s._v(\"pm2 有以下功能：\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"系统崩溃自动重启\")]),s._v(\" \"),a(\"li\",[s._v(\"启动多进程\")]),s._v(\" \"),a(\"li\",[s._v(\"自带日志功能\")])]),s._v(\" \"),a(\"h2\",{attrs:{id:\"_2、下载\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2、下载\"}},[s._v(\"#\")]),s._v(\" 2、下载\")]),s._v(\" \"),a(\"p\",[s._v(\"在全局安装后，任何位置都可以用 pm2 命令。\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-bash extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"npm\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" pm2 -g\\n\\n// 查看版本\\npm2 --version\\npm2 -V\\n\")])])]),a(\"h2\",{attrs:{id:\"_3、基本使用\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3、基本使用\"}},[s._v(\"#\")]),s._v(\" 3、基本使用\")]),s._v(\" \"),a(\"p\",[s._v(\"使用终端进入Node项目的根目录后，执行启动命令 ＋ 项目入口文件名可以启动项目。\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-bash extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[a(\"code\",[s._v(\"pm2 start app.js\\n\")])])]),a(\"p\",[s._v(\"项目启动后\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-bash extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#  查看列表\")]),s._v(\"\\npm2 list\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 重启\")]),s._v(\"\\npm2 restart \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"appname\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"/\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"id\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 停止\")]),s._v(\"\\npm2 stop \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"appname\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"/\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"id\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 删除\")]),s._v(\"\\npm2 delete \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"appname\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"/\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"id\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 基本信息\")]),s._v(\"\\npm2 info \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"appname\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"/\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"id\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 查看日志\")]),s._v(\"\\npm2 log \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"appname\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"/\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"id\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 查看完整信息\")]),s._v(\"\\npm2 monit \"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"appname\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"/\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"<\")]),s._v(\"id\"),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\"\\n\")])])]),a(\"h2\",{attrs:{id:\"_4、配置\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_4、配置\"}},[s._v(\"#\")]),s._v(\" 4、配置\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"新建配置文件\")]),s._v(\" \"),a(\"li\",[s._v(\"修改启动命令\")]),s._v(\" \"),a(\"li\",[s._v(\"检查文件内容\")])]),s._v(\" \"),a(\"p\",[s._v(\"在项目目录下新建一个 \"),a(\"code\",[s._v(\"pm2.conf.json\")]),s._v(\" 的文件。\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-json extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-json\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"apps\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n       \\t\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 名称\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"name\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"koa-blog\"')]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 项目入口\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"script\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" 'app.js'\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 监听文件变化自动重启\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"watch\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token boolean\"}},[s._v(\"true\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 这些文件变化不会自动重启\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"ignore_watch\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"\\n            \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"node_modules\"')]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n            \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"logs\"')]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 进程数量\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"instances\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 错误日志存放位置\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"erorr_file\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"logs/erorr.log\"')]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// console.log打印的日志存放目录\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"out_file\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"logs/out.log\"')]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 日志时间格式\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"log_data_format\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"YYYY-MM-DD HH:mm:ss\"')]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])])]),a(\"p\",[s._v(\"完成后还需要配置一下 \"),a(\"code\",[s._v(\"package.json\")]),s._v(\"文件中的配置\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-json extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-json\"}},[a(\"code\",[s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"scripts\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"prd\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"cross-env NODE_ENV=prduction pm2 start pm2.conf.json\"')]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\"\\n \"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])])]),a(\"h2\",{attrs:{id:\"_5、多进程\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_5、多进程\"}},[s._v(\"#\")]),s._v(\" 5、多进程\")]),s._v(\" \"),a(\"p\",[s._v(\"操作系统会限制每个进程的大小，所以当我们的服务运行在一个进程是会出现这样的问题，虽然我们内存很大，但是分给一个进程的内存并不是全部内存，比如 Node.js 在32位系统中分配的内存为 1.6 G，没有充分利用内存。\")]),s._v(\" \"),a(\"p\",[s._v(\"所以我们在 \"),a(\"code\",[s._v(\"pm2.conf.json\")]),s._v(\" 文件中可以设置进程数量来提高 cpu 利用率。\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-json extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-json\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"apps\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"// 进程数量\")]),s._v(\"\\n    \"),a(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v('\"instances\"')]),a(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\":\")]),s._v(\" \"),a(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);","extractedComments":[]}